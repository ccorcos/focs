#!/bin/bash
set -e

# Check if AFTER date is provided, default to 2024
AFTER="2024-06"

# Find all PDF files and check for corresponding MD files
find docs -mindepth 3 -maxdepth 3 -type f -name "*.pdf"  | sort -r | while read pdf_file; do
    # Extract the date part from the path (docs/org/date/file.pdf)
    date_part=$(echo "$pdf_file" | cut -d'/' -f3)

    # Skip if date is before AFTER
    if [[ "$date_part" < "$AFTER" ]]; then
        continue
    fi

    md_file="${pdf_file%.pdf}.md"
    if [ ! -f "$md_file" ]; then
        echo "Missing markdown file for: $pdf_file"
    elif [ ! -s "$md_file" ]; then
        echo "Empty markdown file for: $pdf_file"
    fi
done


# Check for missing summary.md files in each meeting directory
find docs -mindepth 2 -maxdepth 3 -type d | sort -r| while read dir; do
    # Extract the date part from the path (if it exists)
    date_part=$(echo "$dir" | cut -d'/' -f3)

    # Skip if not a date directory or if date is before AFTER
    if [[ "$date_part" < "$AFTER" ]]; then
        continue
    fi

    if [ ! -s "$dir/summary.md" ]; then
        echo "Empty summary: $dir"
    fi

    # Check for minutes files
    if ! ls -1 "$dir" | grep -i "minutes" > /dev/null 2>&1; then
        # No minutes file found
        if [ -f "$dir/summary.md" ]; then
            echo "Found summary with no minutes: $dir"
        fi
    else
        # Minutes file exists, check for summary
        if [ ! -f "$dir/summary.md" ]; then
            echo "Found minutes with no summary: $dir"
        fi
    fi
done
