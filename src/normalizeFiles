#!/bin/bash

if [[ $# -ne 2 ]]; then
    echo "Usage: $0 <input_directory> <output_directory>"
    exit 1
fi

INPUT_DIR="$1"
OUTPUT_DIR="$2"

if [[ ! -d "$INPUT_DIR" ]]; then
    echo "Error: $INPUT_DIR is not a directory"
    exit 1
fi

# Create output directory if it doesn't exist
mkdir -p "$OUTPUT_DIR"

# Process each file in the directory
find "$INPUT_DIR" -type f | while read -r file; do
    # Get the normalized filename
    normalized_name=$(npx tsx src/utils/normalizeFilename.ts "$file")

    # Get relative path from input dir
    rel_path=${file#$INPUT_DIR/}
    rel_dir=$(dirname "$rel_path")

    # Create subdirectory structure in output dir
    mkdir -p "$OUTPUT_DIR/$rel_dir"

    # Copy file with normalized name
    cp "$file" "$OUTPUT_DIR/$rel_dir/$normalized_name"
    echo "Copied: $file -> $OUTPUT_DIR/$rel_dir/$normalized_name"
done
